!function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=20)}({20:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((i=i.apply(e,t||[])).next())}))};let r;figma.showUI(__html__,{width:166,height:184});let a=[],o=[],s=[],l=[],f={exportRefImage:!1,imgSaveDialog:!1};function c(e,t,n){return i(this,void 0,void 0,(function*(){for(const t in e){const n=e[t].hash,i=e[t].id.replace(/[\\:"*?%<>|]/g,"-").replace(/\s*(\/|\\)\s*/g,"-");try{let e=figma.getImageByHash(n),t=yield e.getBytesAsync();s.push({name:i,bytes:t})}catch(e){}}s.length>0?figma.ui.postMessage({type:"fetchImagesAndAEUX",images:s,data:t,refImg:n}):figma.ui.postMessage({type:"fetchAEUX",data:t})}))}function u(e){try{return"FRAME"!==e.type&&("COMPONENT"!==e.type||"PAGE"!==e.parent.type)||"FRAME"===e.type&&"FRAME"===e.parent.type?u(e.parent):(r=!0,e)}catch(e){figma.ui.postMessage({type:"footerMsg",action:"Error in findFrame() ðŸ˜–",layerCount:null})}}figma.ui.onmessage=e=>{if("getPrefs"===e.type&&figma.clientStorage.getAsync("aeux.prefs").then(t=>t?(figma.ui.postMessage({type:"retPrefs",prefs:t}),t):(figma.clientStorage.setAsync("aeux.prefs",e.defaultPrefs).then(()=>{figma.ui.postMessage({type:"retPrefs",prefs:e.defaultPrefs})}),e.defaultPrefs)).then(e=>{f=e}),"setPrefs"===e.type&&figma.clientStorage.setAsync("aeux.prefs",e.prefs).then(t=>{figma.ui.postMessage(e.prefs),f=e.prefs}),e.type,"exportSelection"===e.type){r=!1,a=[],o=[],s=[],l=[];let t=e.exportJSON||!1;if(figma.currentPage.selection.length<1)return void figma.ui.postMessage({type:"fetchAEUX",data:null});try{let e=function e(t){if(t.length<1)return[];let n=[];t[0]&&("FRAME"===t[0].type&&"PAGE"===t[0].parent.type||"COMPONENT"===t[0].type&&"PAGE"===t[0].parent.type)&&(console.log("GOT A FRAME"),r=!0,a.push(i(t[0],!1)),t=t[0].children);if(t.length<1)return[];return t.forEach(e=>{if(!r){if("PAGE"===e.parent.type)return;let t=i(u(e),!0);t.children=[],a.push(t)}let t=i(e,!1);n.push(t)}),n;function i(t,n){let i=!1,r={children:[],type:null};t.name&&"*"==t.name.charAt(0)&&t!=u(t)&&(console.log("rasterize",t),l.push(t.id),i=!0);for(const a in t)try{let o=t[a];if("children"!==a||n||i||(o=e(o)),"backgrounds"===a&&(o=e(o)),"fills"===a&&o.length>0){let e=!1;for(const t in o){"IMAGE"==o[t].type&&(e=!0,r.rasterize=!0)}e&&l.push(t.id)}if(o==figma.mixed&&"cornerRadius"===a&&(o=Math.min(t.topLeftRadius,t.topRightRadius,t.bottomLeftRadius,t.bottomRightRadius)),o==figma.mixed){let e="getRange"+a.replace(/^\w/,e=>e.toUpperCase());try{o=t[e](0,1)}catch(e){continue}}r[a]=o}catch(e){console.log("ERROR",e)}if("VECTOR"!==t.type&&"BOOLEAN_OPERATION"!==t.type&&"STAR"!==t.type&&"POLYGON"!==t.type&&"ELLIPSE"!==t.type||("fillGeometry"in t&&t.fillGeometry.length>0&&(r.fillGeometry=t.fillGeometry),"strokeGeometry"in t&&t.strokeGeometry.length>0&&(r.strokeGeometry=t.strokeGeometry)),"TEXT"===t.type){if(r._calcLineHeight=null,"PIXELS"===t.lineHeight.unit)r._calcLineHeight=t.lineHeight.value;else if("PERCENT"===t.lineHeight.unit)r._calcLineHeight=t.fontSize*(t.lineHeight.value/100);else{const e=-1===t.characters.indexOf("\n"),n="HEIGHT"===t.textAutoResize||"WIDTH_AND_HEIGHT"===t.textAutoResize;r._calcLineHeight=e&&n?t.height:1.2*t.fontSize}let e=0;try{if(t.characters&&t.characters.trim().length>0){const n=t.clone();figma.currentPage.appendChild(n),n.rotation=0,n.x=0,n.y=0;const i=n.absoluteBoundingBox.y,r=figma.flatten([n]);e=r.absoluteBoundingBox.y-i,r.remove()}}catch(t){console.log("Geometry calc error",t),e=0}r._metricTopOffset=e}return"FRAME"===t.type&&"NONE"!==t.layoutMode&&(r.type="AUTOLAYOUT"),r}}(figma.currentPage.selection);a[0]&&a[0].children?a[0].children=e:a=[{children:e}]}catch(e){console.log(e),console.log("selected layers need to be inside of a frame"),figma.ui.postMessage({type:"footerMsg",action:"Layers must be inside of a frame",layerCount:null})}let n,i,g=null;if(f.exportRefImage){i=u(figma.currentPage.selection[0]);let e=i.name.replace(/\s*(\/|\\)\s*/g,"-").replace(/^\*\s/,"").replace(/^\*/,""),t=figma.createRectangle();t.x=i.x,t.y=i.y,t.resize(i.width,i.height),n=figma.group([t],t.parent),n.appendChild(i),t.isMask=!0,l.push(i.id),g={type:"Image",name:e,id:i.id.replace(/:/g,"-"),frame:{x:i.width/2,y:i.height/2,width:i.width,height:i.height},isVisible:!0,opacity:50,blendMode:"BlendingMode.NORMAL",isMask:!1,rotation:0,guide:!0}}if(l.length>0){l=[...new Set(l)];let e=l.map(e=>(console.log("iten++",e),new Promise(t=>{var n,i;n=e,i=t,setTimeout(()=>{let e,t=figma.getNodeById(n),r=[];var a;t.effects&&(a=t.effects,e=JSON.parse(JSON.stringify(a)),e.forEach(e=>{r.push(e.visible),"DROP_SHADOW"!=e.type&&"LAYER_BLUR"!=e.type||(e.visible=!1)}),t.effects=e);let s=Math.min(3500/Math.max(t.width,t.height),3);t.exportAsync({format:"PNG",useAbsoluteBounds:!0,constraint:{type:"SCALE",value:s}}).then(e=>{o.push({hash:figma.createImage(e).hash,id:`${t.name.replace(/^\*\s/,"").replace(/^\*/,"")}_${n}`})}).then(()=>{for(let t=0;t<r.length;t++)e[t].visible=r[t];t.effects=e}).then(()=>{i()})},100)})));Promise.all(e).then(()=>c(o,a,g)).then(()=>{n&&(n.parent.appendChild(i),n.remove())})}else t?figma.ui.postMessage({type:"exportAEUX",data:a}):o.length<1?figma.ui.postMessage({type:"fetchAEUX",data:a}):c(o,a,null)}if("addRasterizeFlag"===e.type){if(figma.currentPage.selection.length<1)return;let e=function(e,t){u(e[0])==e[0]&&(e=e[0].children);return e.forEach(e=>{"*"!==e.name.charAt(0)&&(e.name="* "+e.name,t++)}),t}(figma.currentPage.selection,0)||0;figma.currentPage.selection=figma.currentPage.selection,figma.ui.postMessage({type:"footerMsg",action:"marked as PNG",layerCount:e})}}}});